{% extends 'base.html.twig' %}

{% block title %}Classe index{% endblock %}

{% block body %}
    <h1>Classe index</h1>

    {% set limit = 5 %}

    <table class="table" id="table-classes">
        <thead>
        <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="table-body-classes">
        {% for classe in classes[:limit] %}
            <tr>
                <td>{{ classe.id }}</td>
                <td>{{ classe.name }}</td>
                <td>
                    <a href="{{ path('app_classe_show', {'id': classe.id}) }}">Show</a>
                    <a href="{{ path('app_classe_edit', {'id': classe.id}) }}">Edit</a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <div id="voir-plus-moins-container">
        {% if classes|length > limit %}
            <a href="#" id="show-more-link-classes" data-limit="{{ limit }}" data-total="{{ classes|length }}">Voir plus ({{ classes|length - limit }} restants)</a>
        {% else %}
            <a href="#" id="show-less-link-classes">Voir moins</a>
        {% endif %}
    </div>

    <a href="{{ path('app_classe_new') }}">Cr√©er <i class="fa-solid fa-plus"></i></a>

    <script>
        document.getElementById('show-more-link-classes').addEventListener('click', function(event) {
            event.preventDefault();

            fetchAllClasses();
        });

        document.getElementById('show-less-link-classes').addEventListener('click', function(event) {
            event.preventDefault();

            var tableBody = document.getElementById('table-body-classes');
            var allRows = tableBody.querySelectorAll('tr');

            // Limit the number of displayed rows to the initial limit
            for (var i = limit; i < allRows.length; i++) {
                allRows[i].style.display = 'none';
            }

            this.style.display = 'none';
            document.getElementById('show-more-link-classes').style.display = 'block';
        });

        function fetchAllClasses() {
            // Implement AJAX request to fetch all classes
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '{{ path('app_classe_index') }}');
            xhr.onload = function() {
                if (xhr.status === 200) {
                    var newRows = createRowsFromClasses(JSON.parse(xhr.responseText)); // Assuming response is in JSON format
                    var tableBody = document.getElementById('table-body-classes');
                    tableBody.innerHTML = newRows;
                } else {
                    console.error('Request failed. Status: ' + xhr.status);
                }
            };
            xhr.send();
        }

        function createRowsFromClasses(classes) {
            // Implement this function to create HTML rows from the fetched classes
            var rows = '';

            classes.forEach(function(classe) {
                rows += '<tr>';
                rows += '<td>' + classe.id + '</td>';
                rows += '<td>' + classe.name + '</td>';
                rows += '<td>';
                rows += '<a href="' + classe.showLink + '">Show</a>';
                rows += '<a href="' + classe.editLink + '">Edit</a>';
                rows += '</td>';
                rows += '</tr>';
            });

            return rows;
        }
    </script>
{% endblock %}
